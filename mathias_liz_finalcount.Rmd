---
title: "mathias_lizard_finalcounts"
author: "sbsambado"
date: "7/13/2021"
output: html_document
---
### Lizard data

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(readr)
library(tidyverse)
library(ggplot2)

library(devtools)
devtools::install_github("an-bui/calecopal")
library(calecopal)
names(cal_palettes)

```

Data cleaning

lizard long
```{r}

liz <- read_csv("Mathias2021_FieldData_Lizard - Sheet1.csv")
dim(liz)

names(liz) <- c('reserve', 'round', 'date', 'site', 'liz', 'burden','l_final', 'n_final', 'lab_l', 'lab_n', 'lab_dc_l', 'lab_dc_n', 'field_count', 'terms')

liz$round <- as.factor(liz$round)


liz$region <- liz$reserve

liz$region[liz$reserve == "McLaughlin"] <- "northern"
liz$region[liz$reserve == "Quail Ridge"] <- "northern"
liz$region[liz$reserve == "Point Reyes"] <- "northern"

liz$region[liz$reserve == "Fort Ord"] <- "central"
liz$region[liz$reserve == "Hastings"] <- "central"
liz$region[liz$reserve == "Big Creek"] <- "central"
liz$region[liz$reserve == "Rancho Marino"] <- "central"

liz$region[liz$reserve == "Sedgwick"] <- "southern"
liz$region[liz$reserve == "Coal Oil Point"] <- "southern"
liz$region[liz$reserve == "Stunt Ranch"] <- "southern"
liz$region[liz$reserve == "Santa Cruz Island"] <- "southern"


liz$reserve <- factor(liz$reserve,
                      levels = c("McLaughlin", "Quail Ridge", "Point Reyes",
                                 "Fort Ord", "Hastings", 
                                 "Big Creek", "Rancho Marino",
                                 "Sedgwick", "Coal Oil Point",
                                 "Stunt Ranch", "Santa Cruz Island"))



liz$location <- liz$region

liz$location[liz$reserve == "McLaughlin"] <- "inland"
liz$location[liz$reserve == "Quail Ridge"] <- "inland"
liz$location[liz$reserve == "Point Reyes"] <- "coastal"

liz$location[liz$reserve == "Fort Ord"] <- "coastal"
liz$location[liz$reserve == "Hastings"] <- "inland"
liz$location[liz$reserve == "Big Creek"] <- "coastal"
liz$location[liz$reserve == "Rancho Marino"] <- "coastal"

liz$location[liz$reserve == "Sedgwick"] <- "inland"
liz$location[liz$reserve == "Coal Oil Point"] <- "coastal"
liz$location[liz$reserve == "Stunt Ranch"] <- "inland"
liz$location[liz$reserve == "Santa Cruz Island"] <- "inland"


liz$month <- liz$date

liz$month[liz$round == "2"] <- "March"
liz$month[liz$round == "3"] <- "April"
liz$month[liz$round == "4"] <- "May"
liz$month[liz$round == "5"] <- "June"

liz$month <- factor(liz$month, 
                    levels = c("March", "April", "May", "June"))

liz$region <- factor(liz$region, 
                     levels = c("northern", "central", "southern"))


regioncolor = c('brown1','tan1','lightgoldenrod1')
locationcolor = c('darkseagreen1', 'brown')

# remove NA from month
liz <- subset(liz, !is.na(month))
```


EDA
```{r}

# total burden
ggplot(liz, aes(x = month, y = log(burden + 1))) +
  geom_boxplot() +
  geom_jitter(aes(color = reserve), alpha = .7, width = .1) +
  scale_color_manual(values = cal_palette("sierra1", n = 11, type = "continuous"))+
  labs(x = "Month",y =  "log(burden + 1)", title = "Lizard burdens across all sites" ) +
  theme(legend.text = element_text(size = 5),
        legend.title = element_text(size = 6),
        axis.title.x = element_text(size = 7)) +
  theme_classic() 


# larval burden
ggplot(liz, aes(x = month, y = log(l_final + 1))) +
  geom_boxplot() +
  geom_jitter(aes(color = reserve), alpha = .7, width = .1) +
  scale_color_manual(values = cal_palette("sierra1", n = 11, type = "continuous"))+
  labs(x = "Month",y =  "log(burden + 1)", title = "Lizard burdens across all sites" ) +
  theme(legend.text = element_text(size = 5),
        legend.title = element_text(size = 6),
        axis.title.x = element_text(size = 7)) +
  theme_classic() 


# nymphal burden
ggplot(liz, aes(x = month, y = log(n_final + 1))) +
  geom_boxplot() +
  geom_jitter(aes(color = reserve), alpha = .7, width = .1) +
  scale_color_manual(values = cal_palette("sierra1", n = 11, type = "continuous"))+
  labs(x = "Month",y =  "log(burden + 1)", title = "Lizard burdens across all sites" ) +
  theme(legend.text = element_text(size = 5),
        legend.title = element_text(size = 6),
        axis.title.x = element_text(size = 7)) +
  theme_classic() 



```

density
```{r}
library(ggridges)

ggplot(liz, aes(x = log(l_final + 1), y = factor(month))) +
    geom_density_ridges(fill = "gray90") +
   labs(x = "Larval count", y = "Month")

ggplot(liz, aes(x = log(n_final + 1), y = factor(month))) +
    geom_density_ridges(fill = "gray90") +
   labs(x = "Nymphal count", y = "Month")

```

lizard tidy

data cleaning
```{r}
liz_tidy <- read_csv("Mathias2021_FieldData_Lizard - lizard_tidy.csv")
dim(liz_tidy)

names(liz_tidy) <- c('reserve', 'round', 'date', 'liz_num', 'count','lifestage')

liz_tidy$round <- as.factor(liz_tidy$round)


liz_tidy$region <- liz_tidy$reserve

liz_tidy$region[liz_tidy$reserve == "McLaughlin"] <- "northern"
liz_tidy$region[liz_tidy$reserve == "Quail Ridge"] <- "northern"
liz_tidy$region[liz_tidy$reserve == "Point Reyes"] <- "northern"

liz_tidy$region[liz_tidy$reserve == "Fort Ord"] <- "central"
liz_tidy$region[liz_tidy$reserve == "Hastings"] <- "central"
liz_tidy$region[liz_tidy$reserve == "Big Creek"] <- "central"
liz_tidy$region[liz_tidy$reserve == "Rancho Marino"] <- "central"

liz_tidy$region[liz_tidy$reserve == "Sedgwick"] <- "southern"
liz_tidy$region[liz_tidy$reserve == "Coal Oil Point"] <- "southern"
liz_tidy$region[liz_tidy$reserve == "Stunt Ranch"] <- "southern"
liz_tidy$region[liz_tidy$reserve == "Santa Cruz Island"] <- "southern"


liz_tidy$reserve <- factor(liz_tidy$reserve,
                      levels = c("McLaughlin", "Quail Ridge", "Point Reyes",
                                 "Fort Ord", "Hastings", 
                                 "Big Creek", "Rancho Marino",
                                 "Sedgwick", "Coal Oil Point",
                                 "Stunt Ranch", "Santa Cruz Island"))



liz_tidy$location <- liz_tidy$region

liz_tidy$location[liz_tidy$reserve == "McLaughlin"] <- "inland"
liz_tidy$location[liz_tidy$reserve == "Quail Ridge"] <- "inland"
liz_tidy$location[liz_tidy$reserve == "Point Reyes"] <- "coastal"

liz_tidy$location[liz_tidy$reserve == "Fort Ord"] <- "coastal"
liz_tidy$location[liz_tidy$reserve == "Hastings"] <- "inland"
liz_tidy$location[liz_tidy$reserve == "Big Creek"] <- "coastal"
liz_tidy$location[liz_tidy$reserve == "Rancho Marino"] <- "coastal"

liz_tidy$location[liz_tidy$reserve == "Sedgwick"] <- "inland"
liz_tidy$location[liz_tidy$reserve == "Coal Oil Point"] <- "coastal"
liz_tidy$location[liz_tidy$reserve == "Stunt Ranch"] <- "inland"
liz_tidy$location[liz_tidy$reserve == "Santa Cruz Island"] <- "inland"


liz_tidy$month <- liz_tidy$round

liz_tidy$month[liz_tidy$round == "2"] <- "March"
liz_tidy$month[liz_tidy$round == "3"] <- "April"
liz_tidy$month[liz_tidy$round == "4"] <- "May"
liz_tidy$month[liz_tidy$round == "5"] <- "June"

liz_tidy$month <- factor(liz_tidy$month, 
                    levels = c("March", "April", "May", "June"))

liz_tidy$region <- factor(liz_tidy$region, 
                     levels = c("northern", "central", "southern"))


regioncolor = c('brown1','tan1','lightgoldenrod1')
locationcolor = c('darkseagreen1', 'brown')

library(lubridate)
liz_tidy$julian <- liz_tidy$date
liz_tidy$julian <- mdy(liz_tidy$date)

#liz_tidy$julian <- as.Date("%m/%d/%y", format = "%m/%d/%Y")

liz_tidy$julian <- format(liz_tidy$julian, "%j")

liz_tidy$julian <- as.numeric(liz_tidy$julian)

liz_tidy$week <- round(liz_tidy$julian/7)
```


```{r}
library(tidyverse)
# remove NA from month
liz_tidy <- subset(liz_tidy, !is.na(month))

# ## only plot extreme season using dplyr from the tidyverse
# ggplot(data = filter(liz_tidy, lifestage %in% c("larval", "nymphal")),
#          aes(y = month, x = log(count +1 ), fill = paste(month, lifestage))) +
#   geom_density_ridges(alpha = .7, rel_min_height = .01,
#                       color = "white", from = -1, to = 5) +
#   #scale_fill_cyclical(breaks = c("1997 Summer", "1997 Winter"),
#                       #labels = c(`1997 Summer` = "Summer",
#                                #  `1997 Winter` = "Winter"),
#                       #values = c("tomato", "dodgerblue"),
#                      # name = "Season:", guide = "legend") +
#   #theme_ridges(grid = FALSE) +
#   labs(x = "Tick counts", y = "Month")

ggplot(data = filter(liz_tidy, lifestage %in% c("larval", "nymphal")),
         aes(y = month, x = log(count +1), fill = paste(lifestage))) +
  facet_wrap(~reserve) +
  geom_density_ridges(alpha = .7, rel_min_height = .01,
                      color = "white", from = -1, to = 5) +
  scale_fill_cyclical(breaks = c("larval", "nymphal"),
                      labels = c(`larval` = "larval",
                                 `nymphal` = "nymphal"),
                      values = c("tomato", "dodgerblue"),
                      name = "Lifestage:", guide = "legend") +
  theme_ridges(grid = FALSE) +
  labs(x = "Tick counts", y = "Month")

liz_tidy_select <- liz_tidy[which(liz_tidy$reserve == "Fort Ord" |
                                  liz_tidy$reserve == "Hastings" |
                                  liz_tidy$reserve == "Big Creek" |
                                  liz_tidy$reserve == "Rancho Marino" |
                                  liz_tidy$reserve == "Sedgwick"),]


ggplot(data = filter(liz_tidy_select, lifestage %in% c("larval", "nymphal")),
         aes(y = month, x = log(count +1), fill = paste(lifestage))) +
  facet_wrap(~reserve) +
  geom_density_ridges(alpha = .7, rel_min_height = .01,
                      color = "white", from = -1, to = 5) +
  scale_fill_cyclical(breaks = c("larval", "nymphal"),
                      labels = c(`larval` = "larval",
                                 `nymphal` = "nymphal"),
                      values = c("tomato", "dodgerblue"),
                      name = "Lifestage:", guide = "legend") +
  theme_ridges(grid = FALSE) +
  labs(x = "Tick counts", y = "Month")


```

```{r}

liz_tidy$count <- as.numeric(liz_tidy$count)
liz_tidy$month <- as.numeric(liz_tidy$month)

ggplot(liz_tidy, aes(y = count, x = month, group = lifestage, fill = lifestage)) +
  geom_smooth(se = FALSE, aes(color = lifestage)) +
  facet_wrap(~location, ncol = 1)


ggplot(liz_tidy, aes(y = count, x = month, group = lifestage, fill = lifestage)) +
  geom_smooth() 

str(liz_tidy)
liz_tidy$julian <- as.Date(liz_tidy$date, format = "%m/%d/%y")
liz_tidy$julian <- format(liz_tidy$julian, "%j")
liz_tidy$week <- round(as.numeric(liz_tidy$julian)/7)


 ggplot(liz_tidy, aes(y = log(count+1), x = julian, group = lifestage, fill = lifestage)) +
  stat_smooth(geom = 'area', method = 'loess', span = .2, alpha = .9)+
 #facet_wrap(~ reserve, scale = 'free_y', ncol = 1)+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 90, size = 10, vjust = 0.5))+
  labs(y = 'Log(tick counts)', x = 'Julian Date')+
  theme(strip.background = element_rect(fill = 'gray95'))+
  theme(strip.text.x = element_text(face = 'bold')) +
  theme(axis.title.y =  element_text(face = 'bold',size = 11, vjust = .5))+
  theme(axis.title.x =  element_text(face = 'bold',size = 11))+
  scale_fill_manual(values = c('#6096c8', '#ffcc00'))+
  labs(fill = "Life stage")+
    theme(legend.title = element_text(size = 7),legend.text = element_text(size = 7))+
    theme(legend.position = c(.067, .940), legend.text = element_text(face = "bold"),
    legend.title = element_text(face = "bold")) 
 
 
```

```{r}
ggplot(liz_tidy, aes(x = month, y = log(count +1) )) +
  geom_boxplot(fill = "gray91") +
  geom_jitter(alpha = .7, width = .1) +
  facet_wrap(~lifestage, ncol = 1) +
  labs(y = "Log(tick burdens + 1", x = "Month") +
  #theme(axis.text.x = element_text(angle = 90, size = 4, vjust = 0.5)) +
  theme_minimal() +
  theme(strip.text.x = element_text(face = 'bold')) +
  theme(axis.title.y =  element_text(face = 'bold',size = 11, vjust = .5))+
  theme(axis.title.x =  element_text(face = 'bold',size = 11))
```

```{r}

liz$ratio <- liz$l_final/liz$n_final

liz$ratio_n <- liz$n_final/liz$burden #nymphs /total 2/6 = .33 3/6 = .5
liz$ratio_l <- liz$l_final/liz$burden # larva /total

# so higher the ratio higher the amount of that life stage

# .5 means equal L to N so more overlap
# high/low  number means less overlap
ggplot(liz, aes(x = month, y = ratio_l)) +
  geom_point() +
  geom_boxplot() + # so May is higher ratio of l 
  geom_hline(yintercept = .5, color = "red", size = 2)
 

ggplot(liz, aes(x = month, y = ratio_n)) +
  geom_point() +
  geom_boxplot() +
  geom_hline(yintercept = .5, color = "red", size = 2)
 

## ratio

ggplot(liz, aes(x = reserve, y = ratio)) +
  geom_point() +
  theme(axis.text.x = element_text(angle = 90, size = 4, vjust = 0.5)) +
  geom_boxplot()

ggplot(liz, aes(x = reserve, y = ratio)) +
  geom_point() +
  theme(axis.text.x = element_text(angle = 90, size = 4, vjust = 0.5)) +
  geom_boxplot() 

ggplot(liz, aes(x = month, y = ratio)) +
  geom_point() +
  geom_boxplot() 


ggplot(liz, aes(x = reserve, y = ratio)) +
  geom_point() +
  theme(axis.text.x = element_text(angle = 90, size = 4, vjust = 0.5)) +
  geom_boxplot()

ggplot(liz, aes(x = reserve, y = ratio)) +
  geom_point() +
  theme(axis.text.x = element_text(angle = 90, size = 4, vjust = 0.5)) +
  geom_boxplot() 


```

```{r}

liz_tidy_select
ggplot(liz_tidy_select, aes(y = reserve, x = count)) +
  geom_boxplot(fill = 'grey89') +
  geom_point() +
  facet_wrap(~lifestage, ncol = 1) +
  #scale_y_discrete(limits = rev(levels(liz_tidy_select$reserve)))+
  theme_minimal()


ggplot(liz_tidy, aes(y = reserve, x = count)) +
  geom_boxplot(fill = 'grey89') +
  geom_point(alpha = .4) +
  facet_wrap(~lifestage, ncol = 1) +
  scale_y_discrete(limits = rev(levels(liz_tidy$reserve))) +
  theme_minimal()
```

```{r}
ggplot(data = liz_tidy, aes(x = month, y = count, group = lifestage)) +
  geom_line(aes(color = lifestage)) +
  facet_wrap(~ region, 
             ncol = 1, 
             scales = "free", 
             strip.position = "right") +
  theme_classic()

liz_tidy_sum <- aggregate(count ~ month + location + lifestage, data = liz_tidy, FUN = mean)


ggplot(data = liz_tidy_sum, aes(x = month, y = count, group = lifestage)) +
  geom_line(aes(color = lifestage), size = 3) +
  facet_wrap(~ location, 
             ncol = 1, 
             scales = "free", 
             strip.position = "right") +
  theme_classic()


liz_tidy_sum_region <- aggregate(count ~ month  + region + lifestage, data = liz_tidy, FUN = mean)


ggplot(data = liz_tidy_sum_region, aes(x = month, y = count, group = lifestage)) +
  geom_line(aes(color = lifestage), size = 3) +
  facet_wrap(~ region, 
             ncol = 1, 
             scales = "free", 
             strip.position = "right") +
  theme_classic()
```

```{r}
# For general stuff:
library(tidyverse)
library(janitor)
library(lubridate)
library(here)
library(paletteer)

# For ts stuff: 
library(tsibble)
library(fable)
library(fabletools)
library(feasts)
library(forecast)

# For spatial stuff: 
library(sf)
library(tmap)
library(mapview)


liz_tidy_l <- liz_tidy %>%
  filter(lifestage == "larval")

# liz_tidy_l %>% gg_subseries(count)
# 
# hydro_quarterly <- liz_tidy %>% 
#   index_by(year_mo = ~ yearmonth(.)) %>% # monthly aggregates
#   summarise(
#     avg_consumption = mean(count)
#   )

# liz_tidy_sum_region <- aggregate(count ~ week  + region + lifestage, data = liz_tidy, FUN = sum)
# 
# ggplot(data = liz_tidy_sum_region, aes(x = week, y = count, group = lifestage)) +
#   geom_line(color = "darkorange") +
#   facet_wrap(~lifestage, ncol = 1) +
#   geom_smooth(color = "purple",
#               size = 0.2,
#               linetype = "dashed",
#               fill = "purple",
#               alpha = 0.2) +
#   theme_minimal()
# 
# 
# sum <- aggregate(count ~ julian + region, data = liz_tidy, FUN = sum)
# hydro_model <- sum %>%
#   model(
#     arima = ARIMA(count),
#     ets = ETS(count)
#   ) %>%
#   fabletools::forecast(h = "2 years")
# 
# hydro_model %>% 
#   autoplot(filter(hydro_ts, 
#                   year(month_sep) > 2010), 
#            level = NULL)



```
PRISM
>[Download and plot PRISM](https://cran.r-project.org/web/packages/prism/vignettes/prism.html#downloading-data)

```{r}
# install.packages("prism")
library(prism)
prism_set_dl_dir("~/Users/samanthasambado/Desktop/R Script/UCNRS/prismtmp")


get_prism_dailys(
  type = "tmean", 
  minDate = "2020-12-01", 
  maxDate = "2021-07-01", 
  keepZip = FALSE
)
get_prism_monthlys(type = "tmean", year = 2019:2021, mon = 1, keepZip = FALSE)
get_prism_annual("ppt", years = 2019:2021, keepZip = FALSE)
```

nteract with the archive and prism data
You can view all the prism data you have downloaded with a simple command: prism_archive_ls(). This function gives a list of folder names, i.e., prism data (pd). All the functions in the prism package work off of one or more of these folder names (pd).

```{r}
## Truncated to keep file list short
prism_archive_ls()


# While prism functions use this folder format, other files may need an absolute path (e.g. the raster package). The pd_to_file() function conveniently returns the absolute path. Alternatively, you may want to see what the normal name for the product is (not the file name), and we can get that with the pd_get_name() function.

## Truncated to keep file list short
pd_to_file(prism_archive_ls())

pd_get_name(prism_archive_ls())
```

Finally, prism_archive_subset() is a convenient way to search for specific parameters, time steps, days, months, years, or ranges of days, months, years.
```{r}
# we know we have downloaded June 2021 daily data, so lets search for those 
prism_archive_subset("tmean", "daily", mon = 6)

# or we can look for days between June 7 and June 10
prism_archive_subset(
  "tmean", "daily", minDate = "2021-06-01", maxDate = "2021-06-10"
)
```

Raster plots
You can easily make a quick plot of your data using the output of prism_archive_ls() or prism_archive_subset() with pd_image().

```{r}
# Plot the January 30-year average temperatures
# grab only the first value, just in case multiple values are returned

# jmean <- prism_archive_subset(
#   "tmean", "monthly normals", mon = 1, resolution = "4km")
# pd_image(jmean)

```

```{r}
# library(raster)

jnorm <- prism_archive_subset(
  "tmean", "monthly normals", mon = 1, resolution = "4km")
j2021 <- prism_archive_subset("tmean", "monthly", years = 2021, mon = 1)


# raster needs a full path, not the "short" prism data name
jnorm <- pd_to_file(jnorm)

j2021 <- pd_to_file(j2021)

## Now we'll load the rasters.
jnorm_rast <- raster(jnorm)
j2021_rast <- raster(j2021)

# Now we can do simple subtraction to get the anomaly by subtracting 2014 
# from the 30 year normal map
anomCalc <- function(x, y) {
  return(x - y)
}

anom_rast <- raster::overlay(j2021_rast,jnorm_rast,fun = anomCalc)

plot(anom_rast)
```

```{r}
library(ggplot2)
# data already exist in the prism dl dir
boulder <- c(-105.2797, 40.0176)

# prism_archive_subset() will return prism data that matches the specified 
# variable, time step, years, months, days, etc.
to_slice <- prism_archive_subset("tmean", "monthly", mon = 1)
p <- pd_plot_slice(to_slice, boulder)

# add a linear average and title
p + 
  stat_smooth(method="lm", se = FALSE) + 
  theme_bw() + 
  ggtitle("Average January temperature in Boulder, CO 1982-2014")
#> `geom_smooth()` using formula 'y ~ x'
```

```{r}
library(leaflet)
library(raster)
library(prism)

# 30-year normal average temperature have already been downloaded for 
norm <- prism_archive_subset(
  "tmean", "monthly normals", resolution = "4km"
)
rast <- raster(pd_to_file(norm))

# Create color palette and plot
pal <- colorNumeric(
  c("#0000FF", "#FFFF00", "#FF0000"), 
  values(rast),
  na.color = "transparent"
)

leaflet() %>% 
  addTiles(
    urlTemplate = 'http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'
  ) %>% 
  addRasterImage(rast, colors = pal, opacity=.65) %>% 
  addLegend(pal = pal, values = values(rast), title = "Deg C")
```

>[R pubs prism](https://rpubs.com/collnell/get_prism)

```{r}
library(devtools) #needed to download prism from github
library(reshape2) ##melting dataframes
library(dplyr) #data wrangling
library(raster) ##working with raster data
library(sp) ##manipulationg spatial data

#install_github(repo = "prism", username = "ropensci")
library(prism) ##prism data access


#get_prism_monthlys(type = 'ppt', years=1990:2016, mon = 7, keepZip = TRUE)
#ls_prism_data(name=TRUE)

new_file<-c(1) ##change to corresponding file numbers
RS <- prism_stack(ls_prism_data()[new_file,1]) ##raster file
to_slice <- grep("_201607",RS[,1],value=T)##search through names


df <- data.frame(rasterToPoints(RS)) ##creates a dataframe of points
month.df <- melt(df, c("x", "y"))
names(month.df)[1:2] <- c("lon", "lat") #rename columns


library(ggplot2) #plotting
library(ggmap) ##theme_nothing()

ggplot()+
  geom_raster(data=month.df, aes(x=lon, y=lat, fill=value))+
  theme_nothing(legend = TRUE)+
  scale_fill_gradient2("Precipitation\n(inches)", low='red',mid='lightblue',high = 'darkslateblue', midpoint=100)+
  labs(title="July Precipitation: 30-year normals")+coord_fixed(ratio=1.3)


```

Filter data to southern California
SoCal is located approximately between 31 & 36 degrees latitude and -124 & -114 longitude.

```{r}
minLat=31
maxLat=36
minLon=-124
maxLon=-114

month.df.socal<-month.df%>%
  filter(minLat < lat, lat < maxLat, minLon < lon, lon <maxLon)%>%
  mutate(ppt = value) %>%
  select(-value)

dim(month.df)
dim(month.df.socal)
```

Filter data to 2020
```{r}
month.df.socal$variable<-as.character(month.df.socal$variable)
july2020<-filter(month.df.socal, grepl(pattern = '2020', variable, fixed=TRUE))


ggplot()+
  geom_raster(data=july2020, aes(x=lon, y=lat, fill=ppt))+
  theme_nothing(legend = TRUE)+
  scale_fill_gradient2("Precipitation\n(inches)", low='red',mid='lightblue',high = 'darkslateblue', midpoint=100)+
  labs(title="July Precipitation: 2016")+coord_fixed(ratio=1.3)


cities<-data.frame(cities =c('Irvine','LA', 'SD', 'Palm Springs'),
                   Lat = c(33.6694649, 34.0522342, 32.7153292, 33.8302961),
                   Long = c(-117.8231107, -118.2436849, -117.1572551, -116.5452921))

cities.spdf<-SpatialPointsDataFrame(coords=cities[,c('Long','Lat')], 
                       data=cities, proj4string = CRS("+proj=longlat +ellps=WGS84 +no_defs"))

city.clim<-extract(RS, cities.spdf,  fun=mean, na.rm=TRUE, sp=TRUE)
```

```{r}
library(tidyverse)
library(sf)
library(raster)
library(prism)
# 

county <- st_read("cb_2018_us_county_20m.shp")


county <- county %>%
  mutate(state = as.numeric(as.character(STATEFP)),
         fips = as.numeric(as.character(GEOID))) %>%
  filter(state != 2, state != 15, state < 60)

st_crs(county)


ggplot(data = county) +
  geom_sf(fill = NA)


options(prism.path = ".")
get_prism_normals(type = 'ppt', resolution = '4km', annual = T, keepZip = TRUE)
prism_archive_ls()
prism_p30 <- pd_stack(prism_archive_ls()[1]) 
county_wgs84 <- st_transform(county, crs(prism_p30))
st_crs(county_wgs84)
cnty_ras <- rasterize(county_wgs84, prism_p30, field = "fips")
cnty_p30 <- zonal(prism_p30, cnty_ras, fun = "mean")

cnty_p30 <- data.frame(cnty_p30)
summary(cnty_p30)

cnty_join1 <- left_join(county_wgs84, cnty_p30, 
                        by = c("fips" = "zone"))

ggplot(data = cnty_join1) +
  geom_sf(aes(fill = value)) +
  scale_fill_continuous(name = "Precip (mm)")


ca_join1 <- filter(cnty_join1, STATEFP == "06")

ggplot(data = ca_join1) +
  geom_sf(aes(fill = value)) +
  scale_fill_continuous(name = "Precip (mm)")
```



### UCNRS weather stations
```{r message = FALSE}
fort <- read_csv("fort-ord-humidity.csv")
fort$reserve <- "Fort Ord"
names(fort) <- c("time", "hum_avg", "hum_max", "hum_min","reserve")

hast <- read_csv("hastings-humidity.csv")
names(hast) <- c("time", "hum_avg", "hum_max", "hum_min","reserve")
hast$reserve <- "Hastings"

big <- read_csv("big-creek-humidity.csv")
names(big) <- c("time", "hum_avg", "hum_max", "hum_min")
big$reserve <- "Big Creek"


ranch <- read_csv("rancho-humidity.csv")
names(ranch) <- c("time", "hum_avg", "hum_max", "hum_min","reserve")
ranch$reserve <- "Rancho Marino"

sedg <- read_csv("sedgwick-humidity.csv")
names(sedg) <- c("time", "hum_avg", "hum_max", "hum_min","reserve")
sedg$reserve <- "Sedgwick"

stunt <- read_csv("stunt-humidity.csv")
names(stunt) <- c("time", "hum_avg", "hum_max", "hum_min","reserve")
stunt$reserve <- "Stunt Ranch"


humidity <- rbind(fort, hast, big, ranch, sedg, stunt)


humidity$region <- humidity$reserve

humidity$region[humidity$reserve == "Fort Ord"] <- "central"
humidity$region[humidity$reserve == "Hastings"] <- "central"
humidity$region[humidity$reserve == "Big Creek"] <- "central"
humidity$region[humidity$reserve == "Rancho Marino"] <- "central"

humidity$region[humidity$reserve == "Sedgwick"] <- "southern"
humidity$region[humidity$reserve == "Stunt Ranch"] <- "southern"


humidity$reserve <- factor(humidity$reserve,
                      levels = c(
                                 "Fort Ord", "Hastings", 
                                 "Big Creek", "Rancho Marino",
                                 "Sedgwick", 
                                 "Stunt Ranch"))



humidity$location <- humidity$region

humidity$location[humidity$reserve == "Fort Ord"] <- "coastal"
humidity$location[humidity$reserve == "Hastings"] <- "inland"
humidity$location[humidity$reserve == "Big Creek"] <- "coastal"
humidity$location[humidity$reserve == "Rancho Marino"] <- "coastal"

humidity$location[humidity$reserve == "Sedgwick"] <- "inland"
humidity$location[humidity$reserve == "Stunt Ranch"] <- "inland"

humidity$date <- as.Date(humidity$time)
humidity$hour <- format(humidity$time, "%H:%M:%S")


liz_tidy$date <- as.Date(liz_tidy$date)

names(liz_tidy) #592
names(humidity)

```

```{r}
# now combine

liz_tidy <- subset(liz_tidy, select = -c(11))


humidity_avg <- aggregate(hum_avg ~ reserve + date, data = humidity, FUN = mean)

humidity_min <- aggregate(hum_min ~ reserve + date, data = humidity, FUN = mean)

humidity_max <- aggregate(hum_max ~ reserve + date, data = humidity, FUN = mean)

full.1 <- merge(liz_tidy,humidity_avg, by = c("date","reserve"))

full.2 <- merge(full.1, humidity_min, by = c("date","reserve"))

full.3 <- merge(full.2, humidity_max, by = c("date","reserve"))
```

```{r}
ggplot(full.3, aes(x = hum_avg, y = log(count + 1))) +
  geom_point() +
  geom_smooth()+
  geom_smooth(aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), color = "red")+
  facet_wrap(~lifestage) +
  theme_bw() +
  coord_cartesian(ylim = c(0,3.5)) +
  ggtitle("Lizard burden ~ Humidity Average %")+
  labs(y = "Log(tick count) per lizard", x = "Humidity Average %") +
  theme(strip.background = element_rect(fill = 'gray95')) + 
  annotate(geom = "text",x = 1, y = 4,  label = "ρ = 0.23, p < .001", size = 5)
  

ggplot(full.3, aes(x = hum_min, y = log(count + 1))) +
  geom_point() +
  geom_smooth(aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), color = "red")+
  facet_wrap(~lifestage)+
  theme_bw() +
  coord_cartesian(ylim = c(0,3.5)) +
  ggtitle("Lizard burden ~ Humidity Min %")+
  labs(y = "Log(tick count) per lizard", x = "Humidity Min %")+
  theme(strip.background = element_rect(fill = 'gray95'))
  
ggplot(full.3, aes(x = hum_max, y = log(count + 1))) +
  geom_point() +
  geom_smooth(aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), color = "red")+
  facet_wrap(~lifestage)+
  theme_bw() +
  coord_cartesian(ylim = c(0,3.5)) +
  ggtitle("Lizard burden ~ Humidity Max %") +
  labs(y = "Log(tick count) per lizard", x = "Humidity Max %")+
  theme(strip.background = element_rect(fill = 'gray95'))
  

## 1 graph 2 lifestages
ggplot(full.3, aes(x = hum_avg, y = log(count + 1), group = lifestage, color = lifestage)) +
  geom_point() +
  geom_smooth(aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..), color = lifestage), size = 1.8, alpha = .25)+
  theme_bw() +
  coord_cartesian(ylim = c(0,3.5), xlim = c(20,100)) +
  ggtitle("Lizard tick burden ~ Humidity Average %")+
  labs(y = "Log(tick count) per lizard", x = "Humidity Average %") +
  scale_color_manual(values = c("#56B4E9","#BF1B0B"))+
  annotate(geom = "text",x = 30.5, y = 3.2,  label = "ρ = 0.23; p < 0.001", color = "red")+
  theme(legend.position = 'bottom', legend.box = 'horizontal')
ggsave("Lizburden_humidity_v3.pdf", dpi = 320)
```

plot humidity 
```{r}
ggplot(humidity, aes(x = time, y = hum_avg, color = location)) +
geom_line(alpha = .2) +
  theme_bw() +
  facet_wrap(~location, ncol = 2)+
  guides(color = FALSE) +
    coord_cartesian(ylim = c(0,100)) +
  ggtitle("Avg Humidity %") 
  
ggplot(humidity, aes(x = time, y = hum_min, color = location)) +
geom_line(alpha = .2) +
  theme_bw() +
  facet_wrap(~location, ncol = 2)+
  guides(color = FALSE) +
    coord_cartesian(ylim = c(0,100))+
  ggtitle("Min Humidity %")

ggplot(humidity, aes(x = time, y = hum_max, color = location)) +
geom_line(alpha = .2) +
  theme_bw() +
  facet_wrap(~location, ncol = 2)+
  guides(color = FALSE) +
    coord_cartesian(ylim = c(0,100))  +
  ggtitle("Max Humidity %")



ggplot(humidity, aes(x = time, y = hum_avg, color = region)) +
geom_line(alpha = .2) +
  theme_bw() +
  facet_wrap(~region, ncol = 2) +
  guides(color = FALSE) +
    coord_cartesian(ylim = c(0,100)) +
  ggtitle("Avg Humidity %")



ggplot(humidity, aes(x = time, y = hum_avg, group = location, color = location)) +
geom_line(color = 'gray56',alpha = .1) +
  scale_fill_manual(values = c("#3D5B59", "#B5651D")) +
  scale_color_manual(values = c("#3D5B59", "#B5651D")) + #749EB2
  theme_bw() +
  stat_smooth(aes(color = location), size = 1.5)+
  #facet_wrap(~location, ncol = 2)+
  #guides(color = FALSE) +
  coord_cartesian(ylim = c(0,100)) +
  #ggtitle("Avg temp (C)") +
  labs(y = "Average Humidity %", x = "Date") +
  theme(strip.background = element_rect(fill = 'gray95'))+
  theme(strip.text.x = element_text(face = 'bold')) +
  theme(axis.title.y =  element_text(face = 'bold',size = 11, vjust = .5))+
  theme(axis.title.x =  element_text(face = 'bold',size = 11, vjust = .5))+
  theme(legend.position = 'bottom', legend.box = 'horizontal')
ggsave("Reserve_hum_v3.pdf", dpi = 320)

```



```{r}
cor.test(full.3$count, full.3$hum_avg) # 0.2252259; p-value = 1.118e-06
cor.test(full.7$count, full.7$temp_avg) # -0.1717307 ; p = 0.000222

```


## temp and precip data
```{r message = FALSE}
fort_w <- read_csv("fort-ord-temp-precip.csv")
fort_w$reserve <- "Fort Ord"
names(fort_w) <- c("time", 
                 "temp_10m_avg", "temp_10m_max","temp_10m_min",
                 "temp_2m_avg", "temp_2m_max","temp_2m_min",
                 "temp_avg",
                 "temp_delta102m_avg","temp_delta102m_max","temp_delta102m_min",
                 "temp_max", "temp_min",
                 "rain_mm",
                 "reserve")

# select only overlapping columns for this analysis 

fort_fin <-  subset(fort_w, select = -c(2:7,9:11))


hast_w <- read_csv("hastings-temp-precip.csv")
hast_w$reserve <- "Hastings"
names(hast_w) <- c("time", 
                 "temp_10m_avg", "temp_10m_max","temp_10m_min",
                 "temp_2m_avg", "temp_2m_max","temp_2m_min",
                 "temp_avg",
                 "temp_delta102m_avg","temp_delta102m_max","temp_delta102m_min",
                 "temp_max", "temp_min",
                 "rain_mm",
                 "reserve")

# select only overlapping columns for this analysis 

hast_fin <-  subset(hast_w, select = -c(2:7,9:11))



big_w <- read_csv("big-creek-temp-precip.csv")
big_w$reserve <- "Big Creek"
names(big_w) <- c("time", 
                 "temp_avg",
                 "temp_max", "temp_min",
                 "rain_mm",
                 "reserve")

rancho_w <- read_csv("rancho-marino-temp-preci.csv")
rancho_w$reserve <- "Rancho Marino"
names(rancho_w) <- c("time", 
                 "temp_10m_avg", "temp_10m_max","temp_10m_min",
                 "temp_2m_avg", "temp_2m_max","temp_2m_min",
                 "temp_avg",
                 "temp_delta102m_avg","temp_delta102m_max","temp_delta102m_min",
                 "temp_max", "temp_min",
                 "rain_mm",
                 "reserve")

# select only overlapping columns for this analysis 

rancho_fin <-  subset(rancho_w, select = -c(2:7,9:11))


sedg_w <- read_csv("sedgwick-temp-precip.csv")
sedg_w$reserve <- "Sedgwick"
names(sedg_w) <- c("time", 
                 "temp_10m_avg", "temp_10m_max","temp_10m_min",
                 "temp_2m_avg", "temp_2m_max","temp_2m_min",
                 "temp_avg",
                 "temp_delta102m_avg","temp_delta102m_max","temp_delta102m_min",
                 "temp_max", "temp_min",
                 "rain_mm",
                 "reserve")

# select only overlapping columns for this analysis 

sedg_fin <-  subset(sedg_w, select = -c(2:7,9:11))



stunt_w <- read_csv("stunt-ranch-temp-precip.csv")
stunt_w$reserve <- "Stunt Ranch"
names(stunt_w) <- c("time", 
                 "temp_10m_avg", "temp_10m_max","temp_10m_min",
                 "temp_2m_avg", "temp_2m_max","temp_2m_min",
                 "temp_avg",
                 "temp_delta102m_avg","temp_delta102m_max","temp_delta102m_min",
                 "temp_max", "temp_min",
                 "rain_mm",
                 "reserve")

# select only overlapping columns for this analysis 

stunt_fin <-  subset(stunt_w, select = -c(2:7,9:11))




# see if they have the same columns
names(fort_w) # 15
names(hast_w) # 15
names(big_w) # only 6
names(rancho_w) # 15
names(sedg_w) # 15
names(stunt_w) # 15


## now combine them 


temp_rain <- rbind(fort_fin, hast_fin, big_w, rancho_fin, sedg_fin, stunt_fin) #152279, 6


## let's add all the other stuf 

temp_rain$region <- temp_rain$reserve

temp_rain$region[temp_rain$reserve == "Fort Ord"] <- "central"
temp_rain$region[temp_rain$reserve == "Hastings"] <- "central"
temp_rain$region[temp_rain$reserve == "Big Creek"] <- "central"
temp_rain$region[temp_rain$reserve == "Rancho Marino"] <- "central"

temp_rain$region[temp_rain$reserve == "Sedgwick"] <- "southern"
temp_rain$region[temp_rain$reserve == "Stunt Ranch"] <- "southern"


temp_rain$reserve <- factor(temp_rain$reserve,
                      levels = c(
                                 "Fort Ord", "Hastings", 
                                 "Big Creek", "Rancho Marino",
                                 "Sedgwick", 
                                 "Stunt Ranch"))



temp_rain$location <- temp_rain$region

temp_rain$location[temp_rain$reserve == "Fort Ord"] <- "coastal"
temp_rain$location[temp_rain$reserve == "Hastings"] <- "inland"
temp_rain$location[temp_rain$reserve == "Big Creek"] <- "coastal"
temp_rain$location[temp_rain$reserve == "Rancho Marino"] <- "coastal"

temp_rain$location[temp_rain$reserve == "Sedgwick"] <- "inland"
temp_rain$location[temp_rain$reserve == "Stunt Ranch"] <- "inland"

temp_rain$date <- as.Date(temp_rain$time)
temp_rain$hour <- format(temp_rain$time, "%H:%M:%S")


```

now combine data
```{r}
temp_avg <- aggregate(temp_avg ~ reserve + date, FUN = mean, data = temp_rain )

temp_min <- aggregate(temp_min ~ reserve + date, FUN = mean , data = temp_rain)

temp_max <- aggregate(temp_max ~ reserve + date, FUN = mean , data = temp_rain)

rain <- aggregate(rain_mm ~ reserve + date,  FUN = mean , data = temp_rain)


full.4 <- merge(full.3,temp_avg, by = c("date","reserve")) #458, 14

full.5 <- merge(full.4, temp_min, by = c("date","reserve")) #458, 15

full.6 <- merge(full.5, temp_max, by = c("date","reserve")) #458, 16

full.7 <- merge(full.6, rain, by = c("date","reserve")) #458, 17 # i need to figure this out since i didn't sample when it was raining

## full.7 has everything we want



```

plot

temp average shows swing
*like this*
```{r}
ggplot(temp_rain, aes(x = time, y = temp_avg, group = location)) +
geom_line(color = "grey82") +
  theme_bw() +
  stat_smooth()+
  facet_wrap(~location, ncol = 2)+
  guides(color = FALSE) +
  coord_cartesian(ylim = c(-13,38)) +
  #ggtitle("Avg temp (C)") +
  labs(y = "Average Temperature (°C)", x = "Date") +
  theme(strip.background = element_rect(fill = 'gray95'))+
  theme(strip.text.x = element_text(face = 'bold')) +
  theme(axis.title.y =  element_text(face = 'bold',size = 11, vjust = .5))+
  theme(axis.title.x =  element_text(face = 'bold',size = 11, vjust = .5))


ggplot(temp_rain, aes(x = time, y = temp_avg, group = location,color = location)) +
geom_line(alpha = .1) +
  scale_fill_manual(values = c("#3D5B59", "#009E73")) +
  scale_color_manual(values = c("#3D5B59", "#009E73")) + #749EB2
  theme_bw() +
  stat_smooth()+
  #facet_wrap(~location, ncol = 2)+
  #guides(color = FALSE) +
  coord_cartesian(ylim = c(-13,38)) +
  #ggtitle("Avg temp (C)") +
  labs(y = "Average Temperature (°C)", x = "Date") +
  theme(strip.background = element_rect(fill = 'gray95'))+
  theme(strip.text.x = element_text(face = 'bold')) +
  theme(axis.title.y =  element_text(face = 'bold',size = 11, vjust = .5))+
  theme(axis.title.x =  element_text(face = 'bold',size = 11, vjust = .5))

ggplot(temp_rain, aes(x = time, y = temp_avg, group = location)) +
geom_line(color = 'gray56',alpha = .1) +
  #scale_fill_manual(values = c("#3D5B59", "#009E73")) +
  scale_color_manual(values = c("#3D5B59", "#B5651D")) + #749EB2 "#009E73"
  theme_bw() +
  stat_smooth(aes(color = location), size = 1.5)+
  #facet_wrap(~location, ncol = 2)+
  #guides(color = FALSE) +
  coord_cartesian(ylim = c(-13,38)) +
  #ggtitle("Avg temp (C)") +
  labs(y = "Average Temperature (°C)", x = "Date") +
  theme(strip.background = element_rect(fill = 'gray95'))+
  theme(strip.text.x = element_text(face = 'bold')) +
  theme(axis.title.y =  element_text(face = 'bold',size = 11, vjust = .5))+
  theme(axis.title.x =  element_text(face = 'bold',size = 11, vjust = .5))+
  theme(legend.position = 'bottom', legend.box = 'horizontal')
ggsave("Reserve_temp_v3.pdf", dpi = 320)

```

```{r}
ggplot(temp_rain, aes(x = time, y = temp_min, color = location)) +
geom_line(alpha = .2) +
  theme_bw() +
  facet_wrap(~location, ncol = 2)+
  guides(color = FALSE) +
  coord_cartesian(ylim = c(-10,34))+
  ggtitle("Min temperature")

ggplot(temp_rain, aes(x = time, y = temp_max, color = location)) +
geom_line(alpha = .2) +
  theme_bw() +
  facet_wrap(~location, ncol = 2)+
  guides(color = FALSE) +
  #coord_cartesian(ylim = c(0,100))  +
  ggtitle("Max temperature ")



ggplot(temp_rain, aes(x = time, y = temp_avg, color = region)) +
geom_line() +
  theme_bw() +
  facet_wrap(~region, ncol = 2)+
  guides(color = FALSE) +
  #coord_cartesian(ylim = c(0,100)) +
  ggtitle("Avg temperature")



```


```{r}
## 1 graph 2 lifestages
ggplot(full.7, aes(x = temp_avg, y = log(count + 1), group = lifestage, color = lifestage)) +
  geom_point() +
  geom_smooth(aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..), color = lifestage), size = 1.8, alpha = .25)+
  theme_bw() +
  #coord_cartesian(ylim = c(0,3.5), xlim = c(20,100)) +
  ggtitle("Lizard tick burden ~ Average temperature (°C)")+
  labs(y = "Log(tick count) per lizard", x = "Average Temperature (°C)", color = "life stage") +
  scale_color_manual(values = c("#56B4E9","#BF1B0B"))+
  theme(legend.position = 'bottom', legend.box = 'horizontal') +
  theme(axis.title.y =  element_text(face = 'bold',size = 12, vjust = .5))+
  theme(axis.title.x =  element_text(face = 'bold',size = 12, vjust = .5)) +
  annotate(geom = "text",x = 20, y = 3.2,  label = "ρ =  -0.1717307; p < .001", color = "red")
ggsave("Lizburden_temp_v1.pdf", dpi = 320)

tick_count <-aggregate(count ~ lifestage, data = liz_tidy, FUN = sum)
ggplot(tick_count, aes(x = lifestage, y = count, fill = lifestage, color = lifestage)) +
  geom_histogram(stat = "identity", width = .9) +
  labs(y = "Total ticks on lizards", x = "Tick life stage") +
  theme_bw() +
  scale_fill_manual(values = c("#56B4E9","#BF1B0B"))+
  scale_color_manual(values = c("#56B4E9","#BF1B0B"))+ #"#E69F00"
  guides(fill = FALSE, color = FALSE) +
  theme(axis.title.y =  element_text(face = 'bold',size = 12, vjust = .5))+
  theme(axis.title.x =  element_text(face = 'bold',size = 12, vjust = .5)) +
  theme(aspect.ratio = 3/1) +
  theme(legend.position = 'bottom', legend.box = 'horizontal')
ggsave("Lizburden_total_v3.pdf", dpi = 320)

sum(liz_tidy$count[liz_tidy$lifestage == "larval"]) #713
sum(liz_tidy$count[liz_tidy$lifestage == "nymphal"]) #791

```
```{r}
library(nlme)
library(lme4)
library(kableExtra)
library(MASS)
library(ggfortify)
library(jtools)
library(effects)
library(pscl)
library(lmtest)
library(ggstance)
library(huxtable)
library(qwraps2)
library(gtsummary)
library(Rcapture)
library(xlsx)
library(glmmTMB) 

hist(full.7$count)

mod.counts_temp <- glm(count ~ temp_avg,
                  family = poisson, data = full.7)
summary(mod.counts_temp) # AIC: 3309.4; p < 0.001
plot(predictorEffects(mod.counts_temp)) # decrease

mod.counts_hum <- glm(count ~ hum_avg,
                  family = poisson, data = full.7)
summary(mod.counts_hum) # AIC: 3209.3; p < 0.001
plot(predictorEffects(mod.counts_hum)) #pos


# 
# full.7$lifestage <- as.factor(full.7$lifestage)
# climate_gnbmod1 <- glm(count ~ temp_avg,
#                        family = "poisson",
#                  data = na.omit(full.7) 
#                  )
# 
# 
# climate_gnbmod2 <- glmer.nb(count ~ humidity_avg +  (1|lifestage), 
#                  data = na.omit(full.7),
#                  family = "poisson")
# 
# 
result <- AIC(mod.counts_temp, mod.counts_hum)
models <- list(mod.counts_temp, mod.counts_hum)



result$BIC <- sapply(models, BIC)
model_summary <- lapply(models, summary)
for(i in 1:(length(models)-1)){ #this creates a variable i that starts with the value i=1
  result$rsq[i] <- model_summary[[i]]$r.squared #we assign the rsq value from model i to the i'th row of the column 'rsq' in the table 'results'
  result$adj_rsq[i] <- model_summary[[i]]$adj.r.squared #same for adjusted rsq
} #now we go back to the beginning of the for-loop, add 1 to the value of i, and do everything again

result$variables <- c("temp_avg", "hum_avg")

climate_models <- kable(result, digits = 2, align = "c") %>%
  kable_styling()


```

